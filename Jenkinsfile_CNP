#!groovy
properties([
        [$class: 'GithubProjectProperty', projectUrlStr: 'https://github.com/hmcts/finrem-ccd-e2e-tests.git'],
        pipelineTriggers([[$class: 'GitHubPushTrigger']])
])

@Library("Infrastructure")

def product = "finrem-ccd"
def component = "e2e"

node {
    ws('workspace/finrem-ccd-e2e-tests') {
        stage('Checkout') {
            deleteDir()
            checkout scm
        }

        stage('Journey Tests') {
             try {
                 sh 'yarn install'
                 sh 'yarn test-e2e'
             }
            catch (Exception err) {
                currentBuild.result = 'UNSTABLE'
                echo "RESULT: ${currentBuild.result}"
            } finally {
                sh 'ls -lart'
                sh 'ls -lrt ./functional-output'
                archiveArtifacts  'functional-output/*'

            }

        }

        stage('After run') {
            echo "finished"
        }

    }
    deleteDir()
}
